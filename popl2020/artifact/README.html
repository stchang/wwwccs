<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Artifact: Dependent Type Systems as Macros</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Artifact:<span class="mywbr"> &nbsp;</span> Dependent Type Systems as Macros</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._local%29" class="tocviewlink" data-pltdoc="x">Local Artifact Setup and Installation (Optional)</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.Paper_section_2__.Creating_a_.Typed_.Language_with_.Racket_and_.Turnstile_%29" class="tocviewlink" data-pltdoc="x">Paper section 2:<span class="mywbr"> &nbsp;</span> Creating a Typed Language with Racket and Turnstile+</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._sec3%29" class="tocviewlink" data-pltdoc="x">Paper section 3:<span class="mywbr"> &nbsp;</span> <span class="RktSym">define-<wbr></wbr>type</span> and Typed Video</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._.Paper_section_4__core_dependent_calculus%29" class="tocviewlink" data-pltdoc="x">Paper section 4:<span class="mywbr"> &nbsp;</span> core dependent calculus</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="#%28part._.Paper_section_5__.Cur%29" class="tocviewlink" data-pltdoc="x">Paper section 5:<span class="mywbr"> &nbsp;</span> Cur</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="#%28part._.Paper_.Section_6__.Companion_.D.S.Ls%29" class="tocviewlink" data-pltdoc="x">Paper Section 6:<span class="mywbr"> &nbsp;</span> Companion DSLs</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="#%28part._.Software_.Foundations__vol__1__examples%29" class="tocviewlink" data-pltdoc="x">Software Foundations (vol. 1) examples</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="#%28part._.Further_.Exploration%29" class="tocviewlink" data-pltdoc="x">Further Exploration</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.Artifact__.Dependent_.Type_.Systems_as_.Macros%29" class="tocsubseclink" data-pltdoc="x">Artifact:<span class="mywbr"> &nbsp;</span> Dependent Type Systems as Macros</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._local%29" class="tocsubseclink" data-pltdoc="x">Local Artifact Setup and Installation (Optional)</a></td></tr><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._.Installing_.Racket%29" class="tocsubseclink" data-pltdoc="x">Installing Racket</a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#%28part._.Installing_.Turnstile_%29" class="tocsubseclink" data-pltdoc="x">Installing Turnstile+</a></td></tr><tr><td><span class="tocsublinknumber">1.3<tt>&nbsp;</tt></span><a href="#%28part._.Installing_.Cur__install_this_after_.Turnstile__%29" class="tocsubseclink" data-pltdoc="x">Installing Cur (install this after Turnstile+<span class="mywbr"> &nbsp;</span>)</a></td></tr><tr><td><span class="tocsublinknumber">1.4<tt>&nbsp;</tt></span><a href="#%28part._.Test_the_.Installations%29" class="tocsubseclink" data-pltdoc="x">Test the Installations</a></td></tr><tr><td><span class="tocsublinknumber">1.5<tt>&nbsp;</tt></span><a href="#%28part._.Running_.Individual_.Examples%29" class="tocsubseclink" data-pltdoc="x">Running Individual Examples</a></td></tr><tr><td><span class="tocsublinknumber">1.6<tt>&nbsp;</tt></span><a href="#%28part._.Removing_installed_artifacts%29" class="tocsubseclink" data-pltdoc="x">Removing installed artifacts</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Paper_section_2__.Creating_a_.Typed_.Language_with_.Racket_and_.Turnstile_%29" class="tocsubseclink" data-pltdoc="x">Paper section 2:<span class="mywbr"> &nbsp;</span> Creating a Typed Language with Racket and Turnstile+</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._sec3%29" class="tocsubseclink" data-pltdoc="x">Paper section 3:<span class="mywbr"> &nbsp;</span> <span class="RktSym">define-<wbr></wbr>type</span> and Typed Video</a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._.Paper_section_4__core_dependent_calculus%29" class="tocsubseclink" data-pltdoc="x">Paper section 4:<span class="mywbr"> &nbsp;</span> core dependent calculus</a></td></tr><tr><td><span class="tocsublinknumber">5<tt>&nbsp;</tt></span><a href="#%28part._.Paper_section_5__.Cur%29" class="tocsubseclink" data-pltdoc="x">Paper section 5:<span class="mywbr"> &nbsp;</span> Cur</a></td></tr><tr><td><span class="tocsublinknumber">6<tt>&nbsp;</tt></span><a href="#%28part._.Paper_.Section_6__.Companion_.D.S.Ls%29" class="tocsubseclink" data-pltdoc="x">Paper Section 6:<span class="mywbr"> &nbsp;</span> Companion DSLs</a></td></tr><tr><td><span class="tocsublinknumber">7<tt>&nbsp;</tt></span><a href="#%28part._.Software_.Foundations__vol__1__examples%29" class="tocsubseclink" data-pltdoc="x">Software Foundations (vol. 1) examples</a></td></tr><tr><td><span class="tocsublinknumber">8<tt>&nbsp;</tt></span><a href="#%28part._.Further_.Exploration%29" class="tocsubseclink" data-pltdoc="x">Further Exploration</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="versionNoNav">7.4.0.10</span></div><h2><a name="(part._.Artifact__.Dependent_.Type_.Systems_as_.Macros)"></a>Artifact: Dependent Type Systems as Macros</h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Stephen Chang &lt;<a href="mailto:stchang@ccs.neu.edu">stchang@ccs.neu.edu</a>&gt;,<br/>Michael Ballantyne &lt;<a href="mailto:mballantyne@ccs.neu.edu">mballantyne@ccs.neu.edu</a>&gt;,<br/>Milo Turner &lt;<a href="mailto:turner.mil@husky.neu.edu">turner.mil@husky.neu.edu</a>&gt;,<br/>and William J. Bowman &lt;<a href="mailto:wjb@williamjbowman.com">wjb@williamjbowman.com</a>&gt;</p></span></div><p>This is the README for the artifact that accompanies "Dependent Type Systems as Macros" in
POPL 2020.  If you have any questions, please email any (or all) of the authors.</p><p>For convenience, the entire artifact is reviewable online in a
browser (at code repos hosted in various locations). Optionally, for
those wishing to further inspect and run files in the artifact, see
<a href="#%28part._local%29" data-pltdoc="x">Local Artifact Setup and Installation (Optional)</a>. Otherwise, the result of running all the examples may
be viewed at the CI service links below.</p><p><div class="SIntrapara">Our artifact consists of:
</div><div class="SIntrapara"><ul><li><p>a copy of the POPL 2020 submission <a href="http://www.ccs.neu.edu/home/stchang/pubs/cbtb-popl2020.pdf">[link]</a>,</p></li><li><p><div class="SIntrapara">the Turnstile+ framework <a href="https://github.com/stchang/macrotypes/tree/popl2020-artifact">[link]</a> (<span class="stt">popl2020-artifact</span> branch),
    </div><div class="SIntrapara"><ul><li><p><a href="https://travis-ci.org/stchang/macrotypes/branches">result of running Turnstile+ test suite</a> (see <span class="stt">popl2020-artifact</span> branch)</p></li></ul></div></p></li><li><p><div class="SIntrapara">the Cur proof assistant <a href="https://github.com/stchang/cur/tree/popl2020-artifact">[link]</a> (<span class="stt">popl2020-artifact</span> branch),
    </div><div class="SIntrapara"><ul><li><p><a href="https://travis-ci.org/stchang/cur/branches">result of running Cur test suite</a> (see <span class="stt">popl2020-artifact</span> branch)</p></li></ul></div></p></li></ul></div></p><p>The goal of this artifact is to provide a guided tour of the code examples
presented in the paper.</p><p>For readability and conciseness, the paper presents simplified
pseudocode that is stylized with colors and abbreviations. Thus
examples from the paper may not run as presented.</p><p><div class="SIntrapara">This artifact connects each stylized example in the paper to runnable versions
of the code. More specifically, we link each of the paper&rsquo;s examples to either:
</div><div class="SIntrapara"><ul><li><p>a standalone, but runnable, version of that example; when the example is a language implementation, we may additionally show examples of programs written in that language, </p></li><li><p>actual lines of code in the implementations of Turnstile+ and/or Cur (in the repositories above),</p></li><li><p>or both.</p></li></ul></div></p><h3>1<tt>&nbsp;</tt><a name="(part._local)"></a>Local Artifact Setup and Installation (Optional)</h3><p>This artifact may be reviewed entirely online. For those who wish to
inspect further, however, this section explains how to locally
install all the artifacts. Skip this section if not installing locally.</p><p>(We have only tested these steps with Linux.)</p><h4>1.1<tt>&nbsp;</tt><a name="(part._.Installing_.Racket)"></a>Installing Racket</h4><p>Install <a href="http://download.racket-lang.org">Racket
7.4</a>. Choosing a non-Unix-style (i.e., local)
installation is probably easiest.</p><p>After installing, add the Racket <span class="stt">bin</span> directory to your <span class="stt">PATH</span>,
i.e., <span class="stt">&lt;your Racket install dir&gt;/bin/</span>. The remaining steps assume that
Racket&rsquo;s <span class="stt">bin</span> directory is in the <span class="stt">PATH</span>.</p><h4>1.2<tt>&nbsp;</tt><a name="(part._.Installing_.Turnstile_)"></a>Installing Turnstile+</h4><ul><li><p>Clone the repository (making sure to use the <span class="stt">popl2020-artifact</span> branch):</p><p><span class="stt">git clone -b popl2020-artifact https://github.com/stchang/macrotypes turnstile+</span></p></li><li><p>Change directory to the Turnstile+ repository root:</p><p><span class="stt">cd turnstile+</span></p></li><li><p>From the Turnstile+ repository root, install Turnstile+ with:</p><p><span class="stt">make install</span></p></li></ul><h4>1.3<tt>&nbsp;</tt><a name="(part._.Installing_.Cur__install_this_after_.Turnstile__)"></a>Installing Cur (install this after Turnstile+)</h4><ul><li><p>Clone the Cur repository (making sure to use the <span class="stt">popl2020-artifact</span> branch):</p><p><span class="stt">git clone -b popl2020-artifact https://github.com/stchang/cur</span></p></li><li><p>Change directory to the Cur repository root:</p><p><span class="stt">cd cur</span></p></li><li><p>From the Cur repository root, install Cur with:</p><p><span class="stt">make install</span></p></li></ul><h4>1.4<tt>&nbsp;</tt><a name="(part._.Test_the_.Installations)"></a>Test the Installations</h4><p>Test that the languages are installed properly by running the test suites.</p><ul><li><p>Turnstile+:</p><ul><li><p><span class="stt">make test</span> (from the Turnstile+ repo root) runs the examples from the paper</p></li><li><p><span class="stt">make test-all</span> (from the Turnstile+ repo root) runs the entire Turnstile+ test suite (including the paper examples) (~5min with 4-core desktop)</p></li></ul></li><li><p>Cur:</p><ul><li><p><span class="stt">make test</span> (from Cur repo root) (~20-30 min)</p></li></ul></li></ul><h4>1.5<tt>&nbsp;</tt><a name="(part._.Running_.Individual_.Examples)"></a>Running Individual Examples</h4><p>If the artifact is successfully installed, each example below may be run with the <span class="stt">racket</span> command, i.e., <span class="stt">racket &lt;path to example file&gt;</span>.</p><h4>1.6<tt>&nbsp;</tt><a name="(part._.Removing_installed_artifacts)"></a>Removing installed artifacts</h4><ul><li><p>Remove Cur (do this first): <span class="stt">make remove</span> (from Cur repo root)</p></li><li><p>Remove Turnstile+: <span class="stt">make remove</span> (from Turnstile+ repo root)</p></li></ul><h3>2<tt>&nbsp;</tt><a name="(part._.Paper_section_2__.Creating_a_.Typed_.Language_with_.Racket_and_.Turnstile_)"></a>Paper section 2: Creating a Typed Language with Racket and Turnstile+</h3><ul><li><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig3-left-stlc.rkt">Figure 3 (left)</a>: STLC, implemented with plain Racket macros, where <span class="RktSym">define-m</span> from the paper is an abbreviation of <span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" class="RktStxLink" data-pltdoc="x">define-syntax</a></span> and <span class="RktSym"><a href="https://docs.racket-lang.org/syntax/Parsing_Syntax.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._syntax-parser%29%29" class="RktStxLink" data-pltdoc="x">syntax-parser</a></span>.</p><p>To be able to write some programs using this language,
we add some language forms not in Figure 3: integer literals (i.e.,
<span class="RktSym">#%datum</span>), an <span class="stt">add1</span> primitive, an Int base type, and a
function arrow type.</p><p>See <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-test/tests/popl2020/fig3-left-stlc-tests.rkt">tests accompanying Figure 3 (left)</a> for examples written with this language. Observe how it uses <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig3-left-stlc.rkt"><span class="stt">fig3-left-stlc.rkt</span></a> as its <span class="stt">#lang</span>.</p><p>The function arrow type in <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig3-left-stlc.rkt"><span class="stt">fig3-left-stlc.rkt</span></a> is <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig6-left-arrow.rkt">the one from Figure 6 (left)</a>.</p><p>The <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig6-left-arrow.rkt"><span class="stt">fig6-left-arrow.rkt</span></a> implementation includes a "pattern macro" (from section 3.4 of the paper), where the <span class="RktSym">define-pattern-m</span> abbreviation from the paper is actually a combination of <span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" class="RktStxLink" data-pltdoc="x">define-syntax</a></span>, <span class="RktSym"><a href="https://docs.racket-lang.org/syntax/stxparse-patterns.html#%28def._%28%28lib._syntax%2Fparse..rkt%29._pattern-expander%29%29" class="RktValLink" data-pltdoc="x">pattern-expander</a></span>, and <span class="RktSym"><a href="https://docs.racket-lang.org/syntax/Parsing_Syntax.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._syntax-parser%29%29" class="RktStxLink" data-pltdoc="x">syntax-parser</a></span>.</p><p>Alternatively, one can use <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig7-left-arrow.rkt">the arrow type from Figure 7 (left)</a>.</p><p>If the artifacts are locally installed, uncomment the appropriate line in <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig3-left-stlc.rkt"><span class="stt">fig3-left-stlc.rkt</span></a> to use this alternate arrow definition.</p></li><li><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig4-core-api.rkt">Figure 4</a>: underlying macro-based typechecking API. The example in Figure 3 (left) uses the core API in this file, where <span class="RktSym"><a href="https://docs.racket-lang.org/reference/stxtrans.html#%28def._%28%28quote._~23~25kernel%29._syntax-local-make-definition-context%29%29" class="RktValLink" data-pltdoc="x">syntax-local-make-definition-context</a></span> and <span class="RktSym"><a href="https://docs.racket-lang.org/reference/stxtrans.html#%28def._%28%28quote._~23~25kernel%29._syntax-local-bind-syntaxes%29%29" class="RktValLink" data-pltdoc="x">syntax-local-bind-syntaxes</a></span> are used to add bindings to the macro environment.</p><p>This is a simplified version of Turnstile+&rsquo;s core API. The next section of this artifact document (<a href="#%28part._sec3%29" data-pltdoc="x">Paper section 3: <span class="RktSym">define-type</span> and Typed Video</a>) will show the analogous functions in Turnstile+&rsquo;s actual implementation.</p></li><li><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig3-right-stlc.rkt">Figure 3 (right)</a>: STLC, implemented with Turnstile+.</p><p>See <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-test/tests/popl2020/fig3-right-stlc-tests.rkt">tests accompanying Figure 3 (right)</a> for examples written with this language.</p></li></ul><h3>3<tt>&nbsp;</tt><a name="(part._sec3)"></a>Paper section 3: <span class="RktSym">define-type</span> and Typed Video</h3><ul><li><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig5-video.rkt">Figure 5</a>: Typed Video core calculus</p><p><div class="SIntrapara">To define <span class="RktSym">&#8594;vid</span>, <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig5-video.rkt"><span class="stt">fig5-video.rkt</span></a> uses <span class="RktSym">define-type</span> by default. But the example also works with alternate <span class="RktSym">&#8594;vid</span> definitions, such as those found in:
      </div><div class="SIntrapara"><ul><li><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig6-right-arrow.rkt">Figure 6 (right)</a></p></li><li><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig7-right-arrow.rkt">Figure 7 (right)</a></p></li></ul></div></p><p>If the artifacts are locally installed, uncomment the appropriate line in <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig5-video.rkt"><span class="stt">fig5-video.rkt</span></a> to use one of these alternate definitions.</p><p>This example also includes the type-level evaluation <span class="RktSym">define-norm</span> definition from Figure 9.</p><p>See <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-test/tests/popl2020/fig5-video-tests.rkt">this test file</a> for examples written with this Typed Video core language.</p></li><li><p><a href="https://github.com/videolang/typed-video/blob/master/typed/video.rkt">Here is a full implementation of Typed Video</a>. It is based on the core language presented in Figure 5.</p><p>Here is a <a href="https://github.com/videolang/typed-video/tree/master/tests">test suite for Typed Video</a>, including <a href="https://github.com/videolang/typed-video/blob/master/tests/paper-tests.rkt#L281-L295">the <span class="RktSym">mk-conf-talk</span> example from the paper</a> (it uses a slightly different syntax for <span class="RktSym">&#8594;vid</span>).</p></li><li><p><div class="SIntrapara">Here is <span class="RktSym">expand/bind</span> and other functions from Figure 8, as they are implemented in Turnstile+:
     </div><div class="SIntrapara"><ul><li><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/macrotypes-lib/macrotypes/typecheck-core.rkt#L1132-L1134"><span class="RktSym">expand/bind</span></a>: The <span class="RktSym">norm</span> function from Figure 9, and on the bottom of page 9 (sec 3.5), is called <span class="RktSym">current-type-eval</span> here.</p></li><li><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/macrotypes-lib/macrotypes/typecheck-core.rkt#L1092-L1103"><span class="RktSym">env-add</span></a>: Again the calls to <span class="RktSym"><a href="https://docs.racket-lang.org/reference/stxtrans.html#%28def._%28%28quote._~23~25kernel%29._syntax-local-bind-syntaxes%29%29" class="RktValLink" data-pltdoc="x">syntax-local-bind-syntaxes</a></span> are (approximately) abbreviated to <span class="RktSym">env-add-m</span> in the paper.</p></li><li><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/macrotypes-lib/macrotypes/typecheck-core.rkt#L1143-L1154"><span class="RktSym">expand/bind/check</span></a>: the <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/macrotypes-lib/macrotypes/typecheck-core.rkt#L494"><span class="RktSym">typecheck?</span></a> function is a wrapper for <span class="RktSym">current-typecheck-relation</span>, which is the <span class="RktSym">stx&#945;=</span> overloadable parameter from the paper.</p></li></ul></div></p></li></ul><h3>4<tt>&nbsp;</tt><a name="(part._.Paper_section_4__core_dependent_calculus)"></a>Paper section 4: core dependent calculus</h3><ul><li><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig10-dep.rkt">Figure 10</a>: dependent core calculus.
See <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-test/tests/popl2020/dep-lang-tests.rkt"><span class="stt">dep-lang-tests.rkt</span></a> for examples written with this core language. It additionally uses some libraries explained below.</p></li><li><p><div class="SIntrapara">Figure 12: the Turnstile+ type eval library, used by <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig10-dep.rkt"><span class="stt">fig10-dep.rkt</span></a>:
</div><div class="SIntrapara"><ul><li><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-lib/turnstile/eval.rkt#L14-L25"><span class="RktSym">reflect</span></a>: called <span class="RktSym">&#8657;</span> in the paper</p></li><li><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-lib/turnstile/eval.rkt#L27-L34"><span class="RktSym">mk-reflected</span></a></p></li><li><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-lib/turnstile/eval.rkt#L36-L75"><span class="RktSym">define-red</span></a></p></li></ul></div></p></li><li><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig13-sugar.rkt">Figure 13</a> sugar library. It only defines "safe" extensions, i.e., sugar for <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig10-dep.rkt"><span class="stt">fig10-dep.rkt</span></a> terms.</p></li><li><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig14-nat.rkt">Figure 14</a>: <span class="RktSym">Nat</span> library. Unlike <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig13-sugar.rkt"><span class="stt">fig13-sugar.rkt</span></a>, these extensions are not safe because they add new type rules.</p></li><li><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig15-eq.rkt">Figure 15</a>: equality library. Similar to <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig14-nat.rkt"><span class="stt">fig14-nat.rkt</span></a>, this library adds new type rules.</p><p>See <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-test/tests/popl2020/dep-lang-tests.rkt"><span class="stt">dep-lang-tests.rkt</span></a> for examples using the sugar, Nat, and equality libraries. We prove a basic zero identity property (left and right) of natural numbers.</p></li><li><p>Figure 16: Here is the <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-lib/turnstile/typedefs.rkt#L162-L203">Turnstile+ <span class="stt">define-type</span></a> that uses the pattern-based substitution from Sec 4.4. The <span class="stt">A</span> pattern variables from the paper are named <span class="stt">Y</span> in the implementation.</p></li><li><p>Figure 17:</p><p>Here is <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/stdlib/axiom.rkt#L19-L24">a Cur library that provides <span class="RktSym">define-axiom</span></a>.</p><p>Here is <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-test/cur/tests/stdlib/axiom.rkt#L36-L48">a Cur program using <span class="RktSym">define-axiom</span></a>.</p></li><li><p>Figure 18 (top):</p><p>Here is <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/stdlib/z3.rkt#L27-L43">a Cur library that provides <span class="RktSym">define-axiom/z3</span></a>, which calls out to a solver. It uses <a href="https://emina.github.io/rosette/">the Rosette language</a> to help translate to Z3 terms.</p><p>Here are <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-test/cur/tests/stdlib/z3.rkt">some Cur programs using <span class="RktSym">define-axiom/z3</span></a>.</p></li><li><p>Figure 18 (bottom):</p><p><a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig18-dep+report.rkt"><span class="stt">fig18-dep+report.rkt</span></a> shows a language implementation that is like <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig10-dep.rkt"><span class="stt">fig10-dep.rkt</span></a>, except its <span class="RktSym">require</span> form is replaced with Figure 18&rsquo;s <span class="RktSym">require/report</span>.</p><p>When the previous examples (see <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-test/tests/popl2020/fig18-dep+report-tests.rkt"><span class="stt">fig18-dep+report-tests.rkt</span></a>) are run, the language reports that the <span class="RktSym">fig15-eq</span> and <span class="RktSym">fig19-data</span> libraries extend the type system, but <span class="RktSym">fig13-sugar</span> does not. (To see the output, either run the test file locally, or see the TravisCI output)</p></li><li><p>Figure 19:
       <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/curnel/coc.rkt">Cur&rsquo;s core calculus</a> is roughly the same as  <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-example/popl2020/fig10-dep.rkt"><span class="stt">fig10-dep.rkt</span></a>, but with a proper universe hierarchy.</p><p>Instead of extending the type system with every new data type like <span class="RktSym">Nat</span> or equality, however, Cur includes <span class="RktSym">define-datatype</span>. <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/curnel/cic-saccharata.rkt#L182">Cur&rsquo;s <span class="RktSym">define-datatype</span> code</a> is almost identical to the code presented in the paper, but includes additional logic such as error handling and positivity checking.</p><p><div class="SIntrapara">Cur uses <span class="RktSym">define-datatype</span> to define libraries like:
       </div><div class="SIntrapara"><ul><li><p><a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/stdlib/nat.rkt"><span class="RktSym">Nat</span></a></p></li><li><p><a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/stdlib/equality.rkt">equality</a></p></li><li><p>and <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/stdlib/list.rkt">lists</a></p></li></ul></div><div class="SIntrapara">And here is <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-test/cur/tests/curnel/datatypes.rkt#L134">a Cur program defining length-indexed lists</a>, like shown in section 4.6 of the paper.</div></p></li></ul><h3>5<tt>&nbsp;</tt><a name="(part._.Paper_section_5__.Cur)"></a>Paper section 5: Cur</h3><ul><li><p>Figure 20: <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/stdlib/sugar.rkt#L299">Cur <span class="RktSym">define-implicit</span></a></p></li><li><p>Figure 21: <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-lib/turnstile/type-constraints.rkt#L37">Turnstile+ <span class="RktSym">unify</span></a>. The name is different (<span class="RktSym">add-constraints</span>) but the cases are the same as in the code presented in the paper.</p></li><li><p>Figure 22: <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/stdlib/sugar.rkt#L96">Cur <span class="RktSym">match</span></a>, where <span class="RktSym">get-datatype-def</span> from the paper is <span class="RktSym">get-match-info</span>, and <span class="RktSym">case-&gt;method</span> from the paper is <span class="RktSym">mk-method</span>.</p></li><li><p>Figure 23 (top): <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-lib/turnstile/typedefs.rkt#L233">Turnstile+ <span class="RktSym">define-type</span> supporting generic methods</a>. A <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-lib/turnstile/typedefs.rkt#L173-L183"><span class="RktSym">maybe-meths</span> syntax class</a> matches the <span class="RktPn">#:implements</span><span class="stt"> </span><span class="RktSym">keyword</span>.</p><p>As mentioned by the paper, <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-lib/turnstile/typedefs.rkt#L276">a table of methods is associated with each type</a>.</p><p>Programmers <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-lib/turnstile/typedefs.rkt#L65-L77">declare new methods with <span class="RktSym">define-generic-type-method</span></a>, which looks up the method in the table, e.g., <a href="https://github.com/stchang/macrotypes/blob/popl2020-artifact/turnstile-lib/turnstile/typedefs.rkt#L79"><span class="RktSym">get-datatype-def</span></a>.</p><p>Figure 23 (bottom): Cur&rsquo;s <span class="RktSym">define-datatype</span> <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/curnel/cic-saccharata.rkt#L302-L306">uses the <span class="RktPn">#:implements</span> declaration</a> to define <span class="RktSym">get-datatype-def</span> for each type.</p></li><li><p>Figure 24: <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/stdlib/sugar.rkt#L189">Cur&rsquo;s <span class="RktSym">define/rec/match</span></a></p></li><li><p>Figure 25: <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/stdlib/sized.rkt">Cur&rsquo;s sized types library</a>, where <span class="RktSym">lift-datatype</span> from the paper is <span class="RktSym">define-sized-datatype</span>, and <span class="RktSym">def/rec/match_sz</span> from the paper is <span class="RktSym">define/rec/match2</span>.</p><p>See the <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-test/cur/tests/stdlib/sized.rkt">runnable versions of the sized type examples from the paper</a> for examples using this library, including the <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-test/cur/tests/stdlib/sized.rkt#L165"><span class="RktSym">div_sz</span> example from the paper.</a></p></li></ul><h3>6<tt>&nbsp;</tt><a name="(part._.Paper_.Section_6__.Companion_.D.S.Ls)"></a>Paper Section 6: Companion DSLs</h3><ul><li><p>Figure 26: <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/olly.rkt">Cur&rsquo;s Olly DSL</a>.</p><p><a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-test/cur/tests/stlc.rkt">Here is the Olly STLC example from the paper.</a></p></li><li><p>Figure 27 (left): <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/ntac/metantac.rkt#L145"><span class="RktSym">define-tactic</span> from metantac</a></p></li><li><p>Figure 27 (right): <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/ntac/standard.rkt#L151">ntac <span class="RktSym">intro</span> tactic</a>, where &#8618; from the paper is <span class="RktSym">$fill</span>, implemented with metantac and <span class="RktSym">define-tactic</span>.</p><p>Figure 27 (right): <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/ntac/standard.rkt#L249">ntac <span class="RktSym">assumption</span> tactic</a>. Here is <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-test/cur/tests/ntac.rkt#L78">the example <span class="stt">id</span> theorem from the paper</a>.</p><p>Figure 27 (bottom): <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/ntac/inversion.rkt#L11">ntac <span class="RktSym">inversion</span> tactic</a>. <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-test/cur/tests/ntac/inversion.rkt">Here are some basic tests using the <span class="stt">inversion</span> tactic</a>. Additional examples can be found in the Software Foundations test suite (see below).</p></li><li><p><a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/ntac/standard.rkt#L137">ntac <span class="RktSym">try</span> tactic</a>, implemented with metantac and <span class="RktSym">define-tactical</span>.</p></li><li><p><a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/ntac/standard.rkt#L424">ntac <span class="RktSym">induction</span> tactic</a>, with optional declarative subgoal checking. <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-test/cur/tests/ntac/induction.rkt">Here are some basic tests using the <span class="stt">inversion</span> tactic</a>. <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-test/cur/tests/ntac/software-foundations/IndProp.rkt#L219">Here is an example with subgoal checking</a>. Additional examples can be found in the Software Foundations test suite (see below).</p></li><li><p><a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-lib/cur/ntac/standard.rkt#L87">ntac <span class="RktSym">interactive</span> tactic</a>. To experiment with the <span class="stt">interactive</span> tactic, one can run the basic <span class="stt">Cur</span> program <span class="RktPn">(</span><span class="RktSym">ntac</span><span class="stt"> </span><span class="RktSym">&lt;my</span><span class="stt"> </span><span class="RktSym">theorem&gt;</span><span class="stt"> </span><span class="RktSym">interactive</span><span class="RktPn">)</span>. <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-test/cur/tests/ntac/interactive.rkt">Here is a starter file</a> with the <span class="RktPn">(</span><span class="RktSym">ntac</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">&#8704;</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">A</span><span class="stt"> </span><span class="RktSym">:</span><span class="stt"> </span><span class="RktSym">Type</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">a</span><span class="stt"> </span><span class="RktSym">:</span><span class="stt"> </span><span class="RktSym">A</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">A</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">interactive</span><span class="RktPn">)</span> example from the paper.</p><p>Additionally, one can look at test cases that check the expected interactive traces, e.g., <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-test/cur/tests/ntac/assert.rkt#L12">here</a>, <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-test/cur/tests/ntac/destruct.rkt#L113">here</a>, <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-test/cur/tests/ntac/reflexivity-poly.rkt">here</a>, and <a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-test/cur/tests/ntac/rewrite-forall.rkt#L215">here</a>.</p></li></ul><h3>7<tt>&nbsp;</tt><a name="(part._.Software_.Foundations__vol__1__examples)"></a>Software Foundations (vol. 1) examples</h3><p><a href="https://github.com/stchang/cur/blob/popl2020-artifact/cur-test/cur/tests/ntac/software-foundations">Software Foundations examples</a></p><p><div class="SIntrapara">Some notes about the test suite:
</div><div class="SIntrapara"><ul><li><p>When there are example proofs, we tried to port the code verbatim.</p></li><li><p>For exercises without answers, we tried to come up with the proof on
our own, interactively, to test that our system could
be used for "real" development.</p></li><li><p>We did not reach 100% covereage of the exercises. For each
chapter, we typically worked through the exercises until we felt that
completing the rest would just be a matter of time, and would not
offer any more insight into the usability our system, or its ability
to implement the required tactics and features. We roughly estimate
that we reached 75% coverage of the exercises.</p></li><li><p>The examples we did not complete were often because Cur&rsquo;s standard
library is not as large as Coq. For example, we do not have the
<span class="stt">sumbool</span> type that is required for the <span class="stt">beq-string</span> examples.</p></li><li><p>We also ignored the chapters that covered features not addressed in
our paper, like extraction.</p></li><li><p>Finally, we do not implement all the same infix notations. This
is a known tradeoff of s-expressions, which use prefix notation, and
thus do not have built-in support for specifying new infix operators
and their precedences. While there are lines of research that seek to
combine infix notation and scheme-style macros (eg Rafkind and Flatt,
GPCE 2012), we felt that such improvements are out of scope for this
initial stage of our project.</p></li></ul></div></p><h3>8<tt>&nbsp;</tt><a name="(part._.Further_.Exploration)"></a>Further Exploration</h3><p><div class="SIntrapara">The purpose of this artifact is to summarize code examples from our paper. For further exploration, documentation is available and may be a good next step:
</div><div class="SIntrapara"><ul><li><p><a href="https://docs.racket-lang.org/turnstile">Turnstile+</a></p></li><li><p><a href="https://docs.racket-lang.org/cur">Cur</a></p></li></ul></div></p><p>Note: The documentation typically lags development of our frameworks,
and thus may not include all the features described in this artifact.</p></div></div><div id="contextindicator">&nbsp;</div></body></html>